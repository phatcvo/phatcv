<!DOCTYPE html>
<html lang="en-us" class="m-auto light"><head>
  <title>Phat C. Vo</title>

<meta name="theme-color" content="" />
<meta charset="utf-8" />
<meta content="width=device-width, initial-scale=1.0" name="viewport" />
<meta name="description" content="Website title" />
<meta name="author" content="Phat C. Vo" />
<meta name="generator" content="aafu theme by Darshan in Hugo 0.120.3" />

        <link rel="apple-touch-icon" sizes="180x180" href="/logo.png">        <link rel="icon" type="image" sizes="32x32" href="/favicon.ico">        <link rel="icon" type="image" sizes="16x16" href="/favicon.ico">        <link rel="manifest" href="/site.webmanifest">        <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#252627">        <link rel="shortcut icon" href="/favicon.ico">        
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.js"></script>
  <!DOCTYPE html>
<html lang="en">
<head>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>

    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js" onload="renderMathInElement(document.body);"></script>

    
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "\\[", right: "\\]", display: true },
                { left: "\\begin{align}", right: "\\end{align}", display: true },
                { left: "\\begin{bmatrix}", right: "\\end{bmatrix}", display: true },
            ],
        });
    });
    </script>

    
</head>
<body>
    
</body>
</html>
  <link
    rel="stylesheet"
    href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"
    integrity="sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu"
    crossorigin="anonymous"
  />
  <link
    rel="stylesheet"
    href="https://cdn.rawgit.com/jpswalsh/academicons/master/css/academicons.min.css"
  />
  <link
    rel="stylesheet"
    href="//fonts.googleapis.com/css?family=Didact+Gothic%7CRoboto:400%7CRoboto+Mono"
  />
  <link rel="stylesheet" href="/css/aafu.css" />
  
  
      <link rel="stylesheet" href="/css/aafu_compiled.css" />
  
  
  
  <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "\\[", right: "\\]", display: true },
                { left: "\begin{bmatrix}", right: "\end{bmatrix}", display: true },
            ],
        });
    });
  </script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.10/katex.min.css">
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.10/katex.min.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.10/contrib/auto-render.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      renderMathInElement(document.body);
    });
  </script>

  <script>
    let html = document.querySelector("html");
    let theme = window.localStorage.getItem("theme");
    if (theme) {
      theme === "dark"
        ? html.classList.add("dark")
        : html.classList.remove("dark");
    } else if (html.classList.contains("dark")) {
      window.localStorage.setItem("theme", "dark");
    } else {
      html.classList.remove("dark");
      window.localStorage.setItem("theme", "light");
    }

    window.onload = () => {
      let themeToggle = document.querySelector(".theme-toggle");
      if (window.localStorage.getItem("theme") === "dark") {
        themeToggle.classList.remove("bi-moon-fill");
        themeToggle.classList.add("bi-brightness-high");
      } else {
        themeToggle.classList.add("bi-moon-fill");
        themeToggle.classList.remove("bi-brightness-high");
      }

      let defaultActivePanel = document.querySelector(".accordion.active");
      if (defaultActivePanel) {
        defaultActivePanel.nextElementSibling.style.maxHeight =
          defaultActivePanel.nextElementSibling.scrollHeight + "px";
      }
    };

    
    window.onresize = () => {
      let defaultActivePanel = document.querySelector(".accordion.active");
      if (defaultActivePanel) {
        defaultActivePanel.nextElementSibling.style.maxHeight =
          defaultActivePanel.nextElementSibling.scrollHeight + "px";
      }
    };
  </script>
  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML">
  </script>

</head>
<body class="h-screen p-2 m-auto max-w-4xl flex flex-col">
    <header
  class="nav flex flex-row row p-2 mb-6 w-full border-b border-gray-300 dark:border-gray-700 justify-between"
>
  <div>
    <a class="mr-4 no-underline p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-800" href="https://phatcvo.github.io">Home</a>    
    <a class="mr-4 no-underline p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-800" href="/blog">Blog(EN)</a>
    <a class="mr-4 no-underline p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-800" href="https://phatcvo.blogspot.com/">Blog(VN)</a>
  </div>
  
  <i
    class="fas fa-sun theme-toggle text-blue-500 hover:text-blue-700 dark:text-yellow-300 dark:hover:text-yellow-500 cursor-pointer text-lg mr-9 sm:mr-0"
    onclick="lightDark(this)"
  ></i>
</header>

<script>
  const lightDark = (el) => {
    let html = document.querySelector("html");
    if (html.classList.contains("dark")) {
      html.classList.remove("dark");
      el.classList.add("bi-moon-fill");
      el.classList.remove("bi-brightness-high");
      window.localStorage.setItem("theme", "light");
    } else {
      html.classList.add("dark");
      el.classList.add("bi-brightness-high");
      el.classList.remove("bi-moon-fill");
      window.localStorage.setItem("theme", "dark");
    }
  }; 



</script>




    <main class="grow">
<div class="prose prose-stone dark:prose-invert max-w-none">
<div class="mb-3">
  <h1 class="top-h1" style="font-size: 2.75em">[Book] Clean Code - Chapter 4</h1>
  <p class="mb-1">January 1, 0001</p>
  <p>&mdash;</p>
</div>
<div class="content">
  <h1 id="chương-4-cơm-mừn">CHƯƠNG 4: CƠM-MỪN</h1>
<p>&ldquo;<em>Đừng biến đống code gớm ghiếc của bạn thành comment - hãy viết lại nó&rdquo;</em><br>
<em>- Brian W. Kernighan and P. J. Plaugher</em></p>
<p>Không gì hữu ích bằng một comment được đặt đúng chổ. Không gì có thể làm lộn xộn đống code của bạn, ngoại trừ những comment ngu xuẩn và dối trá. Và không gì có thể gây nguy hiểm bằng một comment cộc lốc từ đời nào và lại không đúng sự thật.</p>
<p>Các comment không phải là <em>Bản danh sách của Schindler</em> (Schindler&rsquo;s List – <a href="https://en.wikipedia.org/wiki/Schindler%27s_List">https://en.wikipedia.org/wiki/Schindler&rsquo;s_List</a>. Chúng không tốt hoàn toàn như bạn nghĩ. Các comment, tốt nhất, nên trở thành sự lựa chọn cuối cùng. Nếu ngôn ngữ lập trình của chúng ta có đầy đủ khả năng diễn đạt, hoặc nếu chúng ta có đủ tài năng sử dụng code để thể hiện hết ý định của mình thì chúng ta đã không cần đến những dòng comment.</p>
<p>Việc dùng đúng các comment là một cách để bù đắp cho sự thất bại của chúng ta trong việc thể hiện ý nghĩa của những dòng code. Hãy lưu ý rằng tôi đã dùng từ thất bại. Chính xác là vậy – comment luôn luôn là sự thất bại. Chúng ta phải có chúng vì chúng ta không thể thể hiện hết ý nghĩa của code, và việc sử dụng chúng không phải là nguyên nhân được tán dương.</p>
<p>Vậy nên, khi bạn thấy mình cần viết comment, hãy suy nghĩ kỹ xem liệu có cách nào đó để biến các dòng code thành chính xác những gì bạn muốn thể hiện hay không. Mỗi khi bạn thể hiện chính xác ý nghĩa của code, hãy tự khích lệ mình. Mỗi khi bạn viết comment, bạn nên tự vả vào mặt cho sự thất bại đó .</p>
<p>Tại sao tôi lại thất vọng về các comment? Vì chúng đầy dối trá. Không phải lúc nào cũng vậy, nhưng vấn đề này lại rất thường xuyên xãy ra: Comment càng cũ và càng không liên quan tới code mà nó mô tả, càng có nhiều khả năng nó sai. Lý do rất đơn giản, các lập trình viên không thể bảo trì chúng.</p>
<p>Code của dự án thì thay đổi và phát triển liên tục. Các khối dữ liệu di chuyển từ nơi này đến nơi kia. Những khối đó tách ra và tái lập để tạo nên chương trình. Thật không may, những comment không phải lúc nào cũng theo kịp chúng. Comment thì thường xuyên bị tách ra khỏi code mà nó mô tả và trở nên đứt đoạn với độ chính xác giảm dần. Ví dụ, hãy xem những gì xãy ra với comment này và dòng code mà nó dự định mô tả:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>MockRequest request;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> String HTTP_DATE_REGEXP <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;[SMTWF][a-z]{2}\\,\\s[0-9]{2}\\s[JFMASOND][a-z]{2}\\s&#34;</span><span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;[0-9]{4}\\s[0-9]{2}\\:[0-9]{2}\\:[0-9]{2}\\sGMT&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> Response response;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> FitNesseContext context;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> FileResponder responder;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> Locale saveLocale;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Example: &#34;Tue, 02 Apr 2003 22:18:49 GMT&#34;</span>
</span></span></code></pre></div><p>Các biến khác có thể được thêm vào sau đó đặt xen kẽ vào giữa giá trị HTTP_DATE_REGEXP. Giá trị HTTP_DATE_REGEXP được viết lại và comment của bạn thì tan nát. 🙂</p>
<p>Có quan điểm cho rằng các lập trình viên nên có đủ kỷ luật để sửa cả những dòng comment khi họ đã thay đổi code. Tôi đồng ý, họ nên như thế. Nhưng tôi sẽ chọn cách làm cho code rõ ràng dễ hiểu, đến mức nó không cần các comment ngay từ đầu.</p>
<p>Những dòng comment bậy còn tồi tệ hơn là không comment. Chúng lừa gạt và đánh lạc hướng người đọc. Chúng đưa ra những dự tính không bao giờ được thực hiện. Chúng đặt ra những quy tắc cũ, không cần, hoặc không nên được tuân theo nữa.</p>
<p>Chân lý chỉ có thể tìm thấy tại một nơi duy nhất: Code. Chỉ có code mới nói cho bạn biết thật sự những gì nó làm. Nó là nguồn thông tin chính xác duy nhất. Do đó, mặc dù comment đôi khi là cần thiết, nhưng chúng tôi sẽ cố gắng để giảm thiểu nó.</p>
<h2 id="đừng-dùng-comment-để-làm-màu-cho-code">Đừng dùng comment để làm màu cho code</h2>
<p>Một trong những động lực to lớn để viết comment là do code tồi, code tối nghĩa. Chúng ta viết một hàm và chúng ta biết nó khó hiểu, nó vô tổ chức, chúng ta biết nó là một đống hỗ lốn. Vậy nên chúng ta tự nhủ rằng: &ldquo;Ồ, tốt hơn nên viết comment ở đây!&rdquo;. Không! Tốt hơn bạn nên viết lại code!</p>
<p>Code sáng nghĩa và rõ ràng với ít comment sẽ tuyệt vời hơn so với code tối nghĩa, phức tạp với nhiều comment. Thay vì dành thời gian để viết comment giải thích mớ code hỗ lốn đó, hãy dành thời gian để dọn dẹp nó.</p>
<h2 id="giải-thích-ý-nghĩa-ngay-trong-code">Giải thích ý nghĩa ngay trong code</h2>
<p>Chắc chắn có những lúc code của bạn rất khó để giải thích nó đang làm gì. Thật không may, điều này làm cho nhiều lập trình viên cho rằng code hiếm khi là một cách tốt để giải thích. Điều đó hoàn toàn sai. Bạn muốn nhìn thấy điều gì? Cái này:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// Check to see if the employee is eligible for full benefits</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> ((employee.<span style="color:#a6e22e">flags</span> <span style="color:#f92672">&amp;</span> HOURLY_FLAG) <span style="color:#f92672">&amp;&amp;</span> 
</span></span><span style="display:flex;"><span>(employee.<span style="color:#a6e22e">age</span> <span style="color:#f92672">&gt;</span> 65))
</span></span></code></pre></div><p>Hay cái này?</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (employee.<span style="color:#a6e22e">isEligibleForFullBenefits</span>())
</span></span></code></pre></div><p>Chỉ mất vài giây suy nghĩ để truyền hết thông điệp của bạn vào code. Trong nhiều trường hợp, nó chỉ đơn giản là tạo ra một hàm có tên giống với comment mà bạn muốn viết</p>
<h2 id="good-comments">Good Comments</h2>
<p>Một số comment là cần thiết hoặc có ích. Chúng ta sẽ xem xet một vài trường hợp mà tôi cho là xứng đáng để bạn bỏ công ra viết. Tuy nhiên, hãy nhớ rằng comment thật sự tốt là comment không cần phải viết ra.</p>
<h3 id="comment-pháp-lý">Comment pháp lý</h3>
<p>Đôi khi các tiêu chuẩn mã hóa doanh nghiệp buộc chúng ta phải viết một số comment nhất định vì lý do pháp lý. Ví dụ, tuyên bố bản quyền và quyền tác giả là những điều cần thiết và hợp lý để đưa vào comment khi bắt đầu mỗi source code file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">/* Copyright (C) 2003,2004,2005 by Object Mentor, Inc.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * All rights reserved. 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Released under the terms of the GNU General Public License version
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * 2 or later.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span></code></pre></div><p>Đừng đưa cả hợp đồng hay những điều luật vào comment. Nếu có thể, hãy tham khảo một vài giấy phép tiêu chuẩn hay tài liệu bên ngoài khác thay vì đưa tất cả những điều khoản và điều kiện vào.</p>
<h3 id="comment-cung-cấp-thông-tin">Comment cung cấp thông tin</h3>
<p>Cung cấp thông tin cơ bản với một vài dòng comment đôi khi rất hữu ích. Ví dụ, hãy xem cách mà comment này giải thích về giá trị trả về của một phương thức trừu tượng:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// Returns an instance of the Responder being tested.</span>
</span></span><span style="display:flex;"><span>protectedabstractResponder <span style="color:#a6e22e">responderInstance</span>();
</span></span></code></pre></div><p>Một comment như thế này, đôi khi, có thể là hữu ích. Nhưng tốt hơn là sử dụng tên của hàm để truyền đạt thông tin nếu có thể. Ví dụ, trong trường hợp này, chúng ta có thể dọn dẹp comment trên bằng cách đặt lại tên hàm thành responderBeingTested.</p>
<p>Trường hợp dưới đây có vẻ tốt hơn một chút:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// format matched kk:mm:ss EEE, MMM dd, yyyy </span>
</span></span><span style="display:flex;"><span>Pattern timeMatcher <span style="color:#f92672">=</span> Pattern.<span style="color:#a6e22e">compile</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;\\d*:\\d*:\\d* \\w*, \\w* \\d*, \\d*&#34;</span>);
</span></span></code></pre></div><p>Trong trường hợp này, comment cho chúng ta biết rằng biểu thức được tạo ra khớp với thời gian và ngày tháng, và được định dạng bằng hàm SimpleDateFormat.format. Tuy nhiên, nó có thể rõ ràng hơn nếu code này được chuyển sang một lớp đặc biệt chuyển đổi định dạng của ngày và thời gian. Và sau đó, bạn có thể đưa comment trên vào sọt rác.</p>
<h3 id="giải-thích-mục-đích">Giải thích mục đích</h3>
<p>Đôi khi comment không chỉ cung cấp thông tin về những dòng code mà còn cung cấp ý định đằng sau nó. Trong trường hợp sau đây, chúng tôi thấy một comment ghi lại một quyết định thú vị: khi so sánh hai đối tượng, tác giả quyết định rằng anh ta muốn sắp xếp các đối tượng của lớp mình <em>luôn</em> cao hơn các đối tượng khác.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">compareTo</span>(Object o)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(o <span style="color:#66d9ef">instanceof</span> WikiPagePath)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        WikiPagePath p <span style="color:#f92672">=</span> (WikiPagePath) o;
</span></span><span style="display:flex;"><span>        String compressedName <span style="color:#f92672">=</span> StringUtil.<span style="color:#a6e22e">join</span>(names, <span style="color:#e6db74">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>        String compressedArgumentName <span style="color:#f92672">=</span> StringUtil.<span style="color:#a6e22e">join</span>(p.<span style="color:#a6e22e">names</span>, <span style="color:#e6db74">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> compressedName.<span style="color:#a6e22e">compareTo</span>(compressedArgumentName);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> 1; <span style="color:#75715e">// we are greater because we are the right type.</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Dưới đây là một ví dụ tốt hơn. Có thể bạn không đồng tình với cách giải quyết vấn đề của tác giả, nhưng ít ra bạn biết được anh ấy đang cố gắng làm gì</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testConcurrentAddWidgets</span>() <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>    WidgetBuilder widgetBuilder <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> WidgetBuilder(<span style="color:#66d9ef">new</span> Class<span style="color:#f92672">[]</span>{BoldWidget.<span style="color:#a6e22e">class</span>});
</span></span><span style="display:flex;"><span>    String text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#39;&#39;&#39;bold text&#39;&#39;&#39;&#34;</span>;
</span></span><span style="display:flex;"><span>    ParentWidget parent <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> BoldWidget(<span style="color:#66d9ef">new</span> MockWidgetRoot(), <span style="color:#e6db74">&#34;&#39;&#39;&#39;bold text&#39;&#39;&#39;&#34;</span>);
</span></span><span style="display:flex;"><span>    AtomicBoolean failFlag <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> AtomicBoolean();
</span></span><span style="display:flex;"><span>    failFlag.<span style="color:#a6e22e">set</span>(<span style="color:#66d9ef">false</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//This is our best attempt to get a race condition</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//by creating large number of threads.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0; i <span style="color:#f92672">&lt;</span> 25000; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        WidgetBuilderThread widgetBuilderThread <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">new</span> WidgetBuilderThread(widgetBuilder, text, parent,
</span></span><span style="display:flex;"><span>								failFlag);
</span></span><span style="display:flex;"><span>        Thread thread <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread(widgetBuilderThread);
</span></span><span style="display:flex;"><span>        thread.<span style="color:#a6e22e">start</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    assertEquals(<span style="color:#66d9ef">false</span>, failFlag.<span style="color:#a6e22e">get</span>());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><em>Race condition</em> là gì: <a href="https://en.wikipedia.org/wiki/Race_condition">https://en.wikipedia.org/</a></p>
<p>Hoặc link Tiếng Việt: <a href="https://vi.wikipedia.org/wiki/T%C6%B0%C6%A1ng_tranh_%28khoa_h%E1%BB%8Dc_m%C3%A1y_t%C3%ADnh%29">https://vi.wikipedia.org</a></p>
<h3 id="làm-dễ-hiểu">Làm dễ hiểu</h3>
<p>Đôi khi bạn cần dùng comment để diễn giải ý nghĩa của các đối số khó hiểu hoặc giá trị trả về, để biến chúng thành thứ gì đó có thể hiểu được. Nhưng tốt nhất vẫn là tìm cách làm cho các đối số hoặc giá trị trả về đó trở nên rõ ràng theo cách của bạn. Nhưng khi nó là một phần của thư viện, hoặc thuộc về một phần code mà bạn không có quyền tùy chỉnh, thì một comment giải thích dễ hiểu có thể có ích trong trường hợp này.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testCompareTo</span>() <span style="color:#66d9ef">throws</span> Exception
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    WikiPagePath a <span style="color:#f92672">=</span> PathParser.<span style="color:#a6e22e">parse</span>(<span style="color:#e6db74">&#34;PageA&#34;</span>);
</span></span><span style="display:flex;"><span>    WikiPagePath ab <span style="color:#f92672">=</span> PathParser.<span style="color:#a6e22e">parse</span>(<span style="color:#e6db74">&#34;PageA.PageB&#34;</span>);
</span></span><span style="display:flex;"><span>    WikiPagePath b <span style="color:#f92672">=</span> PathParser.<span style="color:#a6e22e">parse</span>(<span style="color:#e6db74">&#34;PageB&#34;</span>);
</span></span><span style="display:flex;"><span>    WikiPagePath aa <span style="color:#f92672">=</span> PathParser.<span style="color:#a6e22e">parse</span>(<span style="color:#e6db74">&#34;PageA.PageA&#34;</span>);
</span></span><span style="display:flex;"><span>    WikiPagePath bb <span style="color:#f92672">=</span> PathParser.<span style="color:#a6e22e">parse</span>(<span style="color:#e6db74">&#34;PageB.PageB&#34;</span>);
</span></span><span style="display:flex;"><span>    WikiPagePath ba <span style="color:#f92672">=</span> PathParser.<span style="color:#a6e22e">parse</span>(<span style="color:#e6db74">&#34;PageB.PageA&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    assertTrue(a.<span style="color:#a6e22e">compareTo</span>(a) <span style="color:#f92672">==</span> 0); <span style="color:#75715e">// a == a</span>
</span></span><span style="display:flex;"><span>    assertTrue(a.<span style="color:#a6e22e">compareTo</span>(b) <span style="color:#f92672">!=</span> 0); <span style="color:#75715e">// a != b</span>
</span></span><span style="display:flex;"><span>    assertTrue(ab.<span style="color:#a6e22e">compareTo</span>(ab) <span style="color:#f92672">==</span> 0); <span style="color:#75715e">// ab == ab</span>
</span></span><span style="display:flex;"><span>    assertTrue(a.<span style="color:#a6e22e">compareTo</span>(b) <span style="color:#f92672">==</span> <span style="color:#f92672">-</span>1); <span style="color:#75715e">// a &lt; b</span>
</span></span><span style="display:flex;"><span>    assertTrue(aa.<span style="color:#a6e22e">compareTo</span>(ab) <span style="color:#f92672">==</span> <span style="color:#f92672">-</span>1); <span style="color:#75715e">// aa &lt; ab</span>
</span></span><span style="display:flex;"><span>    assertTrue(ba.<span style="color:#a6e22e">compareTo</span>(bb) <span style="color:#f92672">==</span> <span style="color:#f92672">-</span>1); <span style="color:#75715e">// ba &lt; bb</span>
</span></span><span style="display:flex;"><span>    assertTrue(b.<span style="color:#a6e22e">compareTo</span>(a) <span style="color:#f92672">==</span> 1); <span style="color:#75715e">// b &gt; a</span>
</span></span><span style="display:flex;"><span>    assertTrue(ab.<span style="color:#a6e22e">compareTo</span>(aa) <span style="color:#f92672">==</span> 1); <span style="color:#75715e">// ab &gt; aa</span>
</span></span><span style="display:flex;"><span>    assertTrue(bb.<span style="color:#a6e22e">compareTo</span>(ba) <span style="color:#f92672">==</span> 1); <span style="color:#75715e">// bb &gt; ba</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Dĩ nhiên, khả năng các comment dạng này cung cấp thông tin không chính xác là khá cao. Xem lại các ví dụ trước để thấy rằng việc xác nhận thông tin từ comment khó thế nào. Điều này giải thích lý do tại sao làm cho comment dễ hiểu là cần thiết, mặc dù điều đó đồng nghĩa với sự mạo hiểm. Vậy nên trước khi bạn viết những comment như thế này, hãy chắc chắn rằng không còn cách nào tối ưu hơn, vì sau đó bạn cần quan tâm đến độ chính xác của chúng mỗi khi bạn chỉnh sửa lại code.</p>
<h3 id="các-cảnh-báo-về-hậu-quả">Các cảnh báo về hậu quả</h3>
<p>Đôi khi nó rất hữu ích để cảnh báo các lập trình viên khác về hậu quả xảy ra. Ví dụ, đây là một comment giải thích tại sao test case này lại bị tắt:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// Don&#39;t run unless you </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// have some time to kill – Đừng chạy hàm này, trừ khi mày quá rảnh </span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">_testWithReallyBigFile</span>() {
</span></span><span style="display:flex;"><span>    writeLinesToFile(10000000);
</span></span><span style="display:flex;"><span>    response.<span style="color:#a6e22e">setBody</span>(testFile); 
</span></span><span style="display:flex;"><span>    response.<span style="color:#a6e22e">readyToSend</span>(<span style="color:#66d9ef">this</span>); 
</span></span><span style="display:flex;"><span>    String responseString <span style="color:#f92672">=</span> output.<span style="color:#a6e22e">toString</span>();
</span></span><span style="display:flex;"><span>    assertSubString(<span style="color:#e6db74">&#34;Content-Length: 1000000000&#34;</span>, responseString); 
</span></span><span style="display:flex;"><span>    assertTrue(bytesSent <span style="color:#f92672">&gt;</span> 1000000000); 
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Tất nhiên là ngày nay, chúng tôi tắt các test case bằng cách sử dụng thuộc tính <code>@Ignore</code> với một chuỗi giải thích thích hợp: <code>@Ignore (&quot;It takes too long to run&quot;)</code>. Nhưng trước khi JUnit 4 xuất hiện, việc đặt một dấu gạch dưới vào trước tên hàm là một quy tắc rất phổ biến. Các comment đồng thời được xem như là cách đánh dấu để lập trình viên chú ý đến cảnh báo của hàm hơn.</p>
<p>Đây là một ví dụ đau khổ khác:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> SimpleDateFormat <span style="color:#a6e22e">makeStandardHttpDateFormat</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//SimpleDateFormat is not thread safe,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//so we need to create each instance independently.</span>
</span></span><span style="display:flex;"><span>    SimpleDateFormat df <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SimpleDateFormat(<span style="color:#e6db74">&#34;EEE, dd MMM yyyy HH:mm:ss z&#34;</span>);
</span></span><span style="display:flex;"><span>    df.<span style="color:#a6e22e">setTimeZone</span>(TimeZone.<span style="color:#a6e22e">getTimeZone</span>(<span style="color:#e6db74">&#34;GMT&#34;</span>));
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> df;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Có thể còn nhiều cách tốt hơn. Tôi đồng ý. Nhưng comment trong trường hợp này là hoàn toàn hợp lý, nó sẽ ngăn được một số lập trình viên ham hố sử dụng một phương thức khởi tạo tĩnh.</p>
<h3 id="todo-comments">TODO comments</h3>
<p>Đôi khi việc để lại các dòng comment dạng //TODO là điều cần thiết. Trong trường hợp dưới đây, comment dạng TODO giải thích tại sao hàm này lại là hàm suy biến, và tương lai của hàm sẽ như thế nào:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// TODO-MdM these are not needed – Hàm này không cần thiết</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// We expect this to go away when we do the checkout model</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Nó sẽ bị xóa khi chúng tôi thực hiện mô hình thanh toán</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">protected</span> VersionInfo <span style="color:#a6e22e">makeVersion</span>() <span style="color:#66d9ef">throws</span> Exception
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Những comment dạng TODO là những công việc mà lập trình viên cho rằng nên được thực hiện, nhưng vì lý do nào đó mà họ không thể thực hiện nó ngay lúc này. Nó có thể là một lời nhắc để xóa một hàm không dùng nữa, hoặc yêu cầu người khác xem xét một số vấn đề: đặt lại một cái tên khác tốt hơn, lời nhắc thay đổi code của hàm khi kế hoạch của dự án thay đổi,.. Nhưng dù TODO có là gì đi nữa, nó chắc chắn không phải là lý do để bạn quăng đống code ẩu, code bừa vào dự án.</p>
<p>Ngày nay, hầu hết các IDE đều cung cấp các tính năng đặc biệt để định vị các comment TODO, do đó bạn không cần lo việc bỏ quên/lạc mất nó. Tuy vậy, bạn sẽ không muốn code của bạn bị lấp đầy bởi TODO. Vậy nên hãy thường xuyên để mắt tới chúng và dọn dẹp chúng ngay khi có thể.</p>
<h3 id="khuếch-đại">Khuếch đại</h3>
<p>Comment có thể được dùng để khuếch đại tầm quan trọng của một cái gì đó có vẻ không quan trọng:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>String listItemContent <span style="color:#f92672">=</span> match.<span style="color:#a6e22e">group</span>(3).<span style="color:#a6e22e">trim</span>();
</span></span><span style="display:flex;"><span><span style="color:#75715e">// the trim is real important. It removes the starting</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// spaces that could cause the item to be recognized</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// as another list.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">new</span> ListItemWidget(<span style="color:#66d9ef">this</span>, listItemContent, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">level</span> <span style="color:#f92672">+</span> 1);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> buildList(text.<span style="color:#a6e22e">substring</span>(match.<span style="color:#a6e22e">end</span>()));
</span></span></code></pre></div><h3 id="javadocs-in-public-apis">Javadocs in Public APIs</h3>
<p>Không có gì hữu ích và tuyệt vời bằng một public API được mô tả tốt. Các javadoc của thư viện chuẩn của Java là một trường hợp điển hình. Sẽ rất khó để viết các chương trình Java mà thiếu chúng.</p>
<p>Nếu đang viết một public API, chắc chắn bạn nên viết javadoc tốt cho nó. Nhưng hãy ghi nhớ những lời khuyên còn lại của chương này, các javadoc có thể là một cú lừa, hoặc mang lại phiền toái như bất kỳ comment nào khác .</p>
<h2 id="bad-comments">Bad Comments</h2>
<p>Đa số các comment rơi vào thể loại này. Chúng thường được sử dụng như cái cớ cho việc viết code rởm hoặc biện minh cho các cách giải quyết đầy thiếu sót, các giá trị không đầy đủ so với cách lập trình viên nghĩ về nó.</p>
<h3 id="độc-thoại">Độc thoại</h3>
<p>Quăng vào một comment chỉ vì bạn thấy <em>thích</em>, hoặc chỉ vì quá trình xử lý cần đến nó, điều đó được gọi là <em>hack</em> (giải quyết vấn đề không theo cách thường mà dùng thủ thuật, đường tắt,&hellip;). Nếu bạn quyết định viết comment, hãy dành thời gian cho nó để đảm bảo đó là comment tốt nhất mà bạn có thể viết.</p>
<p>Dưới đây là một ví dụ tôi tìm thấy trong FitNesse, comment này có thể hữu ích. Nhưng tác giả đã vội vàng hoặc đã không quan tâm nhiều đến nó. Cách anh ta độc thoại làm cho người đến sau cảm thấy hoang mang:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">loadProperties</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        String propertiesPath <span style="color:#f92672">=</span> propertiesLocation <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/&#34;</span> <span style="color:#f92672">+</span> PROPERTIES_FILE;
</span></span><span style="display:flex;"><span>        FileInputStream propertiesStream <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> FileInputStream(propertiesPath);
</span></span><span style="display:flex;"><span>        loadedProperties.<span style="color:#a6e22e">load</span>(propertiesStream);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">catch</span>(IOException e)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// No properties files means all defaults are loaded</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Comment trong khối cacth trên nghĩa là gì? Hẳn là nó có ý nghĩa gì đó đối với tác giả, nhưng lại không được diễn giải đầy đủ. Rõ ràng, nếu IOExeptionxãy ra, điều đó có nghĩa là không có thuộc tính file, và trong trường hợp này các thuộc tính mặc định sẽ được tải. Nhưng, cái gì sẽ tải thuộc tính mặc định? Những thuộc tính mặc định đó đã được tải trước khi gọi loadProperties()? Hay chúng được tải khi loadedProperties.load(propertiesStream) phát sinh Exception? Hay chúng được tải sau khi gọi loadProperties() ? Có phải tác giả chỉ đang cố làm hài lòng chính bản thân anh ta về việc bỏ trống khối catch? Hoặc, kinh khủng hơn – tác giả đã dùng comment như một dấu hiệu, để sau này quay lại và viết các đoạn code tải các thuộc tính mặc định vào khối catch?</p>
<p>Cách duy nhất là kiểm tra code của hệ thống để tìm hiểu những gì xảy ra. Bất kỳ comment nào khiến bạn phải lục tung code của hệ thống lên để tìm hiểu thì comment đó không truyền tải tốt thông tin cho bạn, và nó không xứng đáng với số bit nó chiếm trong mã nguồn.</p>
<h3 id="các-comment-thừa-thải">Các comment thừa thải</h3>
<p>Listing 4-1 cho thấy một hàm đơn giản với các comment ở đầu hoàn toàn thừa thải. Comment này, có lẽ, còn làm người đọc mất thời gian hơn so với việc đọc code của hàm.</p>
<table>
<thead>
<tr>
<th>Listing 4-1 <strong>waitForClose</strong></th>
</tr>
</thead>
</table>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// Utility method that returns when this.closed is true. Throws an exception</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// if the timeout is reached.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Phương thức return khi this.closed là true, phát sinh ngoại lệ nếu hết thời gian chờ</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">synchronized</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">waitForClose</span>(<span style="color:#66d9ef">final</span> <span style="color:#66d9ef">long</span> timeoutMillis)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">throws</span> Exception
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span>closed)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        wait(timeoutMillis);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span>closed)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Exception(<span style="color:#e6db74">&#34;MockResponseSender could not be closed&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Comment này nhằm mục đích gì? Nó chắn chắn không cung cấp nhiều thông tin hơn code. Nó không diễn giải cho code, không cung cấp mục đích hoặc lý do. Nó không dễ hiểu hơn code. Sự thật là, nó ít chính xác hơn code nhưng lại lôi cuốn người đọc chấp nhận sự thiếu chính xác đó thay cho hiểu biết thật sự.</p>
<p>Bây giờ hãy xem xét vô số comment vô ích và dư thừa của javadocs trong Listing 4-2 được lấy từ Tomcat. Những comment này chỉ để làm lộn xộn và làm code thêm khó hiểu. Chúng tồn tại nhưng không vì mục đích cung cấp thông tin mà chỉ khiến mọi thứ tệ hơn. Tôi chỉ chỉ ra cho bạn được một vài dòng đầu tiên, còn nhiều hơn nữa nếu bạn xem qua hết module này.</p>
<table>
<thead>
<tr>
<th>Listing 4-2 <strong>ContainerBase.java (Tomcat)</strong></th>
</tr>
</thead>
</table>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ContainerBase</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">implements</span> Container, Lifecycle, Pipeline,
</span></span><span style="display:flex;"><span>MBeanRegistration, Serializable {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * The processor delay for this component.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">int</span> backgroundProcessorDelay <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>1;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * The lifecycle event support for this component.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> LifecycleSupport lifecycle <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> LifecycleSupport(<span style="color:#66d9ef">this</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * The container event listeners for this Container.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> ArrayList listeners <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList();
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * The Loader implementation with which this Container is
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * associated.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> Loader loader <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * The Logger implementation with which this Container is
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * associated.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> Log logger <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Associated logger name.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> String logName <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * The Manager implementation with which this Container is
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * associated.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> Manager manager <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * The cluster with which this Container is associated.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> Cluster cluster <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * The human-readable name of this Container.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> String name <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * The parent Container to which this Container is a child.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> Container parent <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * The parent class loader to be configured when we install a
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Loader.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> ClassLoader parentClassLoader <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * The Pipeline object with which this Container is
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * associated.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> Pipeline pipeline <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> StandardPipeline(<span style="color:#66d9ef">this</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * The Realm with which this Container is associated.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> Realm realm <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * The resources DirContext object with which this Container
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * is associated.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> DirContext resources <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span></code></pre></div><h3 id="các-comment-sai-sự-thật">Các comment sai sự thật</h3>
<p>Đôi khi, với mục đích hoàn toàn trong sáng, một lập trình viên diễn đạt ý định của anh ta trong comment, nhưng nó lại không đủ chính xác. Hãy dành một ít thời gian để xem lại comment dư thừa và sai lệch trong Listing 4-1.</p>
<p>Bạn có phát hiện ra comment ở Listing 4-1 sai lệch như thế nào chưa? Phương thức không <code>return</code> khi <code>this.closed</code> là <code>true</code>, nó <code>return</code> nếu <code>this.closed</code> là <code>true</code>. Mặt khác, nó giả vờ chờ một khoản thời gian và sinh ra một Exception nếu <code>this.closed</code> vẫn chưa là <code>true</code>.</p>
<p>Một chút thông tin sai lệch, ẩn nấp trong một comment khó đọc hơn cả code mà nó diễn giải. Điều này có thể khiến một lập trình viên khác gọi hàm này và mong muốn nó return ngay khi this.closed trở thành true. Sau đó anh ta phải debug chương trình để tìm câu trả lời cho việc nó thực thi quá chậm.</p>
<h3 id="các-comment-bắt-buộc">Các comment bắt buộc</h3>
<p>Thật điên rồ khi cho rằng tất cả các hàm đều phải có javadoc, hoặc mọi biến đều phải có comment. Những comment như vậy chỉ làm rối code, đưa ra những lời bịa đặt, và ủng hộ việc gây nhầm lẫn và vô tổ chức.</p>
<p>Ví dụ, javadoc được yêu cầu cho mọi hàm dẫn đến sự kinh khủng khiếp như Listing 4-3. Tình trạng lộn xộn này không giúp ích được gì mà ngược lại,nó chỉ làm xáo trộn code và ngầm tạo ra những cú lừa khác,&hellip;</p>
<table>
<thead>
<tr>
<th>Listing 4-3</th>
</tr>
</thead>
</table>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param title The title of the CD
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param author The author of the CD
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param tracks The number of tracks on the CD
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param durationInMinutes The duration of the CD in minutes
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">addCD</span>(String title, String author,
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">int</span> tracks, <span style="color:#66d9ef">int</span> durationInMinutes) {
</span></span><span style="display:flex;"><span>    CD cd <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> CD();
</span></span><span style="display:flex;"><span>    cd.<span style="color:#a6e22e">title</span> <span style="color:#f92672">=</span> title;
</span></span><span style="display:flex;"><span>    cd.<span style="color:#a6e22e">author</span> <span style="color:#f92672">=</span> author;
</span></span><span style="display:flex;"><span>    cd.<span style="color:#a6e22e">tracks</span> <span style="color:#f92672">=</span> tracks;
</span></span><span style="display:flex;"><span>    cd.<span style="color:#a6e22e">duration</span> <span style="color:#f92672">=</span> duration;
</span></span><span style="display:flex;"><span>    cdList.<span style="color:#a6e22e">add</span>(cd);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="các-comment-nhật-ký">Các comment nhật ký</h3>
<p>Đôi khi mọi người thêm một comment vào đầu module mỗi khi họ chỉnh sửa nó. Những comment này tích lũy như một loại nhật ký lưu lại mọi thay đổi đã từng được thực hiện. Tôi đã thấy một số module với hàng trăm dòng như thế này:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Changes (from 11-Oct-2001)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * --------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * 11-Oct-2001 : Re-organised the class and moved it to new package
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * com.jrefinery.date (DG);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * 05-Nov-2001 : Added a getDescription() method, and eliminated NotableDate
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * class (DG);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * 12-Nov-2001 : IBD requires setDescription() method, now that NotableDate
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * class is gone (DG); Changed getPreviousDayOfWeek(),
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * getFollowingDayOfWeek() and getNearestDayOfWeek() to correct
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * bugs (DG);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * 05-Dec-2001 : Fixed bug in SpreadsheetDate class (DG);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * 29-May-2002 : Moved the month constants into a separate interface
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * (MonthConstants) (DG);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * 27-Aug-2002 : Fixed bug in addMonths() method, thanks to N???levka Petr (DG);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * 03-Oct-2002 : Fixed errors reported by Checkstyle (DG);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * 13-Mar-2003 : Implemented Serializable (DG);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * 29-May-2003 : Fixed bug in addMonths method (DG);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * 04-Sep-2003 : Implemented Comparable. Updated the isInRange javadocs (DG);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * 05-Jan-2005 : Fixed bug in addYears() method (1096282) (DG);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span></code></pre></div><p>Ngày xửa ngày xưa, chúng tôi có lý do chính đáng để tạo và cập nhật các nhật ký này khi bắt đầu một module. Ở thời điểm đó, các hệ thống quản lý mã nguồn (source control) chưa xuất hiện và chúng tôi phải thực hiện điều này. Nhưng ngày nay, những nhật ký này chỉ làm module lộn xộn hơn. Chúng nên được loại bỏ hoàn toàn.</p>
<h3 id="các-comment-gây-nhiễu">Các comment gây nhiễu</h3>
<p>Đôi khi bạn gặp các comment không cung cấp thông tin gì ngoài sự phiền phức, chúng lặp lại một vấn đề hiển nhiên và không cung cấp thêm thông tin mới</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Default constructor.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">protected</span> <span style="color:#a6e22e">AnnualDateRule</span>() {
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Rìa-lý? Còn cái này:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">/** The day of the month. */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> dayOfMonth;
</span></span></code></pre></div><p>Và sau đó là sự thừa thãi này:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Returns the day of the month.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @return the day of the month.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">getDayOfMonth</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> dayOfMonth;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Những comment này phiền đến mức chúng tôi phải học cách bỏ qua chúng. Khi chúng tôi đọc code, mắt chúng tôi chỉ lướt qua chúng. Cuối cùng, các comment bắt đầu sai lệch khi code xung quanh chúng thay đổi, còn chúng thì không – ai lại để ý đến chúng chứ.</p>
<p>Comment đầu tiên trong Listing 4-4 có vẻ hợp lý, nó giải thích tại sao khối <code>catch</code> được bỏ qua. Nhưng comment thứ hai chỉ đơn thuần là gây nhiễu cho người đọc. Rõ ràng lập trình viên này đã rất mệt mỏi với việc viết các khối <code>try/catch</code> và anh ta đang trút giận.</p>
<table>
<thead>
<tr>
<th>Listing 4-4 <strong>startSending</strong></th>
</tr>
</thead>
</table>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">startSending</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        doSending();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">catch</span>(SocketException e)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// normal. someone stopped the request.</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">catch</span>(Exception e)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            response.<span style="color:#a6e22e">add</span>(ErrorResponder.<span style="color:#a6e22e">makeExceptionString</span>(e));
</span></span><span style="display:flex;"><span>            response.<span style="color:#a6e22e">closeAll</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">catch</span>(Exception e1)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//Give me a break! – Đưa tao ra khỏi đây!</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Thay vì trút giận vào một comment vô giá trị và gây bối rối cho người đọc, lập trình viên nên nhận ra rằng vấn đề của anh ta có thể được giải quyết bằng cách tái cấu trúc lại phần code đó. Anh ta nên sử dụng năng lượng của mình cho việc chuyển khối try/catch đó thành một hàm riêng biệt, như trong Listing 4-5</p>
<table>
<thead>
<tr>
<th>Listing 4-5 <strong>startSending (refactored)</strong></th>
</tr>
</thead>
</table>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">startSending</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        doSending();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">catch</span>(SocketException e)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// normal. someone stopped the request.</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">catch</span>(Exception e)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        addExceptionAndCloseResponse(e);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">addExceptionAndCloseResponse</span>(Exception e)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        response.<span style="color:#a6e22e">add</span>(ErrorResponder.<span style="color:#a6e22e">makeExceptionString</span>(e));
</span></span><span style="display:flex;"><span>        response.<span style="color:#a6e22e">closeAll</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">catch</span>(Exception e1)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Tránh việc viết comment gây nhiễu bằng quyết tâm làm sạch code. Bạn sẽ thấy điều đó làm cho bạn trở thành một lập trình viên đẳng cấp hơn, và hạnh phúc hơn.</p>
<h3 id="lại-là-các-comment-gây-nhiễu--nhưng-đáng-sợ-hơn">(Lại là) các comment gây nhiễu – nhưng đáng sợ hơn</h3>
<p>Các javadoc cũng có thể trở nên phiền phức. Mục đích của các javadoc sau là gì (từ một thư viện mã nguồn mở nổi tiếng)? Trả lời: Không gì cả. Chúng chỉ là những comment dư thừa, bị sao chép lại như một khao khát cung cấp tài liệu cho lập trình viên.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">/** The name. */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> String name;
</span></span><span style="display:flex;"><span><span style="color:#75715e">/** The version. */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> String version;
</span></span><span style="display:flex;"><span><span style="color:#75715e">/** The licenceName. */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> String licenceName;
</span></span><span style="display:flex;"><span><span style="color:#75715e">/** The version. */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> String info;
</span></span></code></pre></div><p>Xem những comment trên một lần nữa, bạn có thấy lỗi cắt-dán không? Nếu tác giả đã không chú ý đến comment khi viết (hoặc dán) chúng, sao chúng ta có thể trông mong chúng giúp ích được chúng ta?</p>
<h3 id="đừng-dùng-comment-khi-bạn-có-thể-dùng-hàm-hoặc-biến">Đừng dùng comment khi bạn có thể dùng hàm hoặc biến</h3>
<p>Hãy xem xét đoạn code sau:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// does the module from the global list &lt;mod&gt; depend on the</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// subsystem we are part of?</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (smodule.<span style="color:#a6e22e">getDependSubsystems</span>().<span style="color:#a6e22e">contains</span>(subSysMod.<span style="color:#a6e22e">getSubSystem</span>()))
</span></span></code></pre></div><p>Chúng có thể được viết lại mà không cần comment:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>ArrayList moduleDependees <span style="color:#f92672">=</span> smodule.<span style="color:#a6e22e">getDependSubsystems</span>();
</span></span><span style="display:flex;"><span>String ourSubSystem <span style="color:#f92672">=</span> subSysMod.<span style="color:#a6e22e">getSubSystem</span>();
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (moduleDependees.<span style="color:#a6e22e">contains</span>(ourSubSystem))
</span></span></code></pre></div><p>Có thể tác giả đã viết comment trước (tôi đoán thế), và sau đó viết code để hoàn thành nội dung của comment. Tuy nhiên, tác giả nên tái cấu trúc code, như tôi đã làm, để comment được xóa mà không ảnh hưởng đến thông điệp của đoạn code đó.</p>
<h3 id="đánh-dấu-lãnh-thổ">Đánh dấu lãnh thổ</h3>
<p>Thỉnh thoảng vài lập trình viên thích đánh dấu một vị trí trong tệp mã nguồn. Ví dụ, gần đây tôi đã thấy thứ này trong một chương trình tôi đang xem xét:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// Actions //////////////////////////////////</span>
</span></span></code></pre></div><p>Rất hiếm khi các hàm có cùng chức năng được tập hợp bên dưới một câu miêu tả như thế này. Nhưng nói chung, chúng đang bừa bộn nên cần phải loại bỏ, đặc biệt là cả tá dấu slash ở cuối câu.</p>
<p>Theo cách nghĩ này, một comment đánh dấu sẽ gây chú ý mạnh nếu bạn không thường xuyên nhìn thấy chúng. Vì vậy, hãy hạn chế dùng, và chỉ dùng nếu chúng mang lại lợi ích đáng kể. Nếu bị lạm dụng, chúng sẽ bị người đọc cho vào vùng &ldquo;phiền phức&rdquo; và nhanh chóng bị bỏ qua.</p>
<h3 id="các-comment-kết-thúc">Các comment kết thúc</h3>
<p>Đôi khi các lập trình viên sẽ đưa ra các comment cụ thể về việc đóng dấu ngoặc nhọn, như trong Listing 4-6. Mặc dù điều này có thể có ý nghĩa với các hàm dài và có nhiều cấu trúc lồng nhau, nhưng chúng lại thường được dùng trong các hàm nhỏ, hoặc các hàm mà lập trình viên thấy thích. Vì vậy lần tới nếu muốn đánh dấu kết thúc một khối lệnh phức tạp, hãy thử chia nhỏ hoặc rút ngắn hàm của bạn.</p>
<table>
<thead>
<tr>
<th>Listing 4-6 <strong>wc.java</strong></th>
</tr>
</thead>
</table>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">wc</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) {
</span></span><span style="display:flex;"><span>        BufferedReader in <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BufferedReader(<span style="color:#66d9ef">new</span> InputStreamReader(System.<span style="color:#a6e22e">in</span>));
</span></span><span style="display:flex;"><span>        String line;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> lineCount <span style="color:#f92672">=</span> 0;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> charCount <span style="color:#f92672">=</span> 0;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> wordCount <span style="color:#f92672">=</span> 0;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> ((line <span style="color:#f92672">=</span> in.<span style="color:#a6e22e">readLine</span>()) <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                lineCount<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>                charCount <span style="color:#f92672">+=</span> line.<span style="color:#a6e22e">length</span>();
</span></span><span style="display:flex;"><span>                String words<span style="color:#f92672">[]</span> <span style="color:#f92672">=</span> line.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#34;\\W&#34;</span>);
</span></span><span style="display:flex;"><span>                wordCount <span style="color:#f92672">+=</span> words.<span style="color:#a6e22e">length</span>;
</span></span><span style="display:flex;"><span>            } <span style="color:#75715e">//while</span>
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;wordCount = &#34;</span> <span style="color:#f92672">+</span> wordCount);
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;lineCount = &#34;</span> <span style="color:#f92672">+</span> lineCount);
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;charCount = &#34;</span> <span style="color:#f92672">+</span> charCount);
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// try</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Error:&#34;</span> <span style="color:#f92672">+</span> e.<span style="color:#a6e22e">getMessage</span>());
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">//catch</span>
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">//main</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="thuộc-tính-và-dòng-tác-giả">Thuộc tính và dòng tác giả</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">/* Added by Rick */</span>
</span></span></code></pre></div><p>Hệ thống quản lý mã nguồn ghi nhớ rất tốt việc ai đã thêm gì, thêm khi nào,.. Không cần phải làm ô nhiễm code bằng những dòng tác giả. Bạn có thể nghĩ rằng những comment như vậy sẽ hữu ích, người khác sẽ biết ai đã làm việc với phần code đó. Nhưng thực tế là chúng có xu hướng ở lại đó trong nhiều năm, và ngày càng ít chính xác, và ít liên quan.</p>
<p>Nhắc lại lần nữa, hệ thống quản lý mã nguồn là nơi tốt hơn để lưu những thông tin này.</p>
<h3 id="comment-hóa-code">Comment-hóa code</h3>
<p>Comment-hóa code (chuyển code thành comment) là một trong những thói quen khiến lập trình viên dễ bị ghét nhất. Đừng làm việc đó!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>InputStreamResponse response <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> InputStreamResponse();
</span></span><span style="display:flex;"><span>response.<span style="color:#a6e22e">setBody</span>(formatter.<span style="color:#a6e22e">getResultStream</span>(), formatter.<span style="color:#a6e22e">getByteCount</span>());
</span></span><span style="display:flex;"><span><span style="color:#75715e">// InputStream resultsStream = formatter.getResultStream();</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// StreamReader reader = new StreamReader(resultsStream);</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// response.setContent(reader.read(formatter.getByteCount()));</span>
</span></span></code></pre></div><p>Những người khác khi thấy comment dạng này sẽ không đủ dũng cảm để xóa nó. Họ nghĩ rằng nó nằm đó vì một lý do nào đó, và chắc hẳn là nó quan trọng.</p>
<p>Hãy xem xét đoạn code dưới đây:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">bytePos</span> <span style="color:#f92672">=</span> writeBytes(pngIdBytes, 0);
</span></span><span style="display:flex;"><span><span style="color:#75715e">//hdrPos = bytePos;</span>
</span></span><span style="display:flex;"><span>writeHeader();
</span></span><span style="display:flex;"><span>writeResolution();
</span></span><span style="display:flex;"><span><span style="color:#75715e">//dataPos = bytePos;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (writeImageData()) {
</span></span><span style="display:flex;"><span>    writeEnd();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">pngBytes</span> <span style="color:#f92672">=</span> resizeByteArray(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">pngBytes</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">maxPos</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">pngBytes</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">pngBytes</span>;
</span></span></code></pre></div><p>Tại sao lại có hai dòng code bị chuyển thành comment? Chúng có quan trọng không? Có phải chúng để lại một lời nhắc cho một số thay đổi sắp xảy ra? Hay chúng chỉ là một dòng comment đã tồn tại từ nhiều năm trước và đơn giản là không ai thèm dọn dẹp?</p>
<p>Đã từng có một thời gian, vào những năm 60, khi những comment dạng này có ích. Nhưng hiện tại hệ thống quản lý mã nguồn đang và sẽ tiếp tục hoạt động tốt. Hệ thống quản lý mã nguồn sẽ nhớ code cho tôi và bạn, và chắc chắn không có lý do gì để comment-hóa một dòng code. Hãy xóa dòng code đó, chúng ta sẽ không bị mất nó. Tôi thề đấy.</p>
<h3 id="html-comment">HTML comment</h3>
<p>Đưa HTML vào comment là một hành động xúc phạm lập trình viên. Như cách mà bạn thấy bên dưới. Nó làm comment khó đọc trực tiếp nhưng lại dễ đọc hơn trên trình soạn thảo hoặc IDE khác. Nếu các comment được trích xuất bởi công cụ và hiển thị như một trang web, việc tô vẽ cho comment bằng HTML là trách nhiệm của công cụ đó, chứ không phải của lập trình viên.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Task to run fit tests.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * This task runs fitnesse tests and publishes the results.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * &lt;p/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * &lt;pre&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Usage:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * &amp;lt;taskdef name=&amp;quot;execute-fitnesse-tests&amp;quot;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * classname=&amp;quot;fitnesse.ant.ExecuteFitnesseTestsTask&amp;quot;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * classpathref=&amp;quot;classpath&amp;quot; /&amp;gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * OR
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * &amp;lt;taskdef classpathref=&amp;quot;classpath&amp;quot;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * resource=&amp;quot;tasks.properties&amp;quot; /&amp;gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * &lt;p/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * &amp;lt;execute-fitnesse-tests
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * suitepage=&amp;quot;FitNesse.SuiteAcceptanceTests&amp;quot;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * fitnesseport=&amp;quot;8082&amp;quot;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * resultsdir=&amp;quot;${results.dir}&amp;quot;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * resultshtmlpage=&amp;quot;fit-results.html&amp;quot;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * classpathref=&amp;quot;classpath&amp;quot; /&amp;gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * &lt;/pre&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span></code></pre></div><h3 id="thông-tin-phi-tập-trung">Thông tin phi tập trung</h3>
<p>Nếu bắt buộc phải viết một comment, hãy đảm bảo rằng nó giải thích cho phần code gần nó nhất. Đừng cung cấp thông tin của toàn bộ hệ thống trong một comment cục bộ. Xem xét ví dụ dưới đây: Dù thừa thải nhưng nó cung cấp thông tin về cổng mặc định. Tuy nhiên hàm này lại hoàn toàn không có quyền kiểm soát cổng mặc định. Comment không mô tả cho hàm, mà mô tả một phần nào đó trong hệ thống. Tất nhiên, không có gì đảm bảo comment này sẽ được thay đổi khi code mà nó mô tả thay đổi.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Port on which fitnesse would run. Defaults to &lt;b&gt;8082&lt;/b&gt;.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param fitnessePort
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setFitnessePort</span>(<span style="color:#66d9ef">int</span> fitnessePort)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">fitnessePort</span> <span style="color:#f92672">=</span> fitnessePort;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="quá-nhiều-thông-tin">Quá nhiều thông tin</h3>
<p>Đừng đưa các cuộc thảo luận hoặc mô tả không liên quan vào comment của bạn. Comment dưới đây được lấy ra từ một module có chức năng mã hóa và giải mã base64. Một người nào đó có thể đọc code này mà không cần những thông tin phức tạp từ comment.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> RFC 2045 - Multipurpose Internet Mail Extensions (MIME)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> Part One: Format of Internet Message Bodies
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> section 6.8. Base64 Content-Transfer-Encoding
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> The encoding process represents 24-bit groups of input bits as output
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> strings of 4 encoded characters. Proceeding from left to right, a
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> 24-bit input group is formed by concatenating 3 8-bit input groups.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> These 24 bits are then treated as 4 concatenated 6-bit groups, each
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> of which is translated into a single digit in the base64 alphabet.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> When encoding a bit stream via the base64 encoding, the bit stream
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> must be presumed to be ordered with the most-significant-bit first.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> That is, the first bit in the stream will be the high-order bit in
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> the first 8-bit byte, and the eighth bit will be the low-order bit in
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> the first 8-bit byte, and so on.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span></code></pre></div><h3 id="mối-quan-hệ-khó-hiểu">Mối quan hệ khó hiểu</h3>
<p>Sự kết nối giữa comment và code mà nó mô tả nên rõ ràng. Nếu bạn gặp khổ sở khi phải viết comment, ít nhất bạn cũng muốn người khác nhìn vào comment và hiểu những gì nó đang nói về code.</p>
<p>Xem xét ví dụ sau:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * start with an array that is big enough to hold all the pixels
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * (plus filter bytes), and an extra 200 bytes for header info
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * bắt đầu với một mảng đủ lớn để chứa tất cả các pixel
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * (cộng với một số byte của bộ lọc), và thêm 200 byte cho tiêu đề
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">pngBytes</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[</span>((<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">width</span> <span style="color:#f92672">+</span> 1) <span style="color:#f92672">*</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">height</span> <span style="color:#f92672">*</span> 3) <span style="color:#f92672">+</span> 200<span style="color:#f92672">]</span>;
</span></span></code></pre></div><p>Một byte của bộ lọc nghĩa là gì? Nó có liên quan gì đến +1 không? Hay *3? Hay cả hai? Tại sao lại là giá trị 200 mà không phải giá trị khác? Mục đích của comment là để giải thích code, không phải giải thích chính nó. Thật đáng tiếc khi comment lại cần một lời giải thích cho riêng mình.</p>
<h3 id="comment-làm-tiêu-đề-cho-hàm">Comment làm tiêu đề cho hàm</h3>
<p>Các hàm ngắn không cần nhiều mô tả. Đặt một cái tên đủ tốt cho hàm thường tốt hơn việc đặt một comment ở trước hàm đó.</p>
<h3 id="javadocs-trong-code-không-công-khai">Javadocs trong code không công khai</h3>
<p>[&hellip;] Việc tạo các trang javadoc cho các lớp và các hàm trong hệ thống thường không hữu ích, và thủ tục bổ sung các comment không khác gì sự lộn xộn và làm mất thời gian.</p>
<h3 id="ví-dụ">Ví dụ</h3>
<p>Tôi đã viết module trong Listing 4-7 cho <em>XP Immersion</em> đầu tiên. Nó được dự định là một ví dụ về phong cách viết code xấu và comment xấu. Kent Back sau đó đã tái cấu trúc code này lại dưới hình thức dễ chịu hơn trước mặt hàng tá sinh viên. Sau đó tôi đã điều chỉnh chúng để phù hợp với quyển sách <em>Agile Software Development, Principles, Patterns, and Practices</em> và bài viết <em>Craftsman</em> đầu tiên đã được xuất bản trên tạp chí <em>Software Development</em>.</p>
<p>Điều tôi cảm thấy thú vị trong module này là, đã có lúc nhiều người trong chúng tôi xem nó là một <em>tài liệu tham khảo hay</em>. Còn bây giờ chúng ta xem nó là một mớ lộn xộn. Hãy xem có bao nhiêu vấn đề về comment mà bạn có thể tìm thấy.</p>
<table>
<thead>
<tr>
<th>Listing 4-7 <strong>GeneratePrimes.java</strong></th>
</tr>
</thead>
</table>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * This class Generates prime numbers up to a user specified
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * maximum. The algorithm used is the Sieve of Eratosthenes.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * &lt;p&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Eratosthenes of Cyrene, b. c. 276 BC, Cyrene, Libya --
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * d. c. 194, Alexandria. The first man to calculate the
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * circumference of the Earth. Also known for working on
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * calendars with leap years and ran the library at Alexandria.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * &lt;p&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * The algorithm is quite simple. Given an array of integers
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * starting at 2. Cross out all multiples of 2. Find the next
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * uncrossed integer, and cross out all of its multiples.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Repeat untilyou have passed the square root of the maximum
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * value.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @author Alphonse
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @version 13 Feb 2002 atp
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.*;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">GeneratePrimes</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    * @param maxValue is the generation limit.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> <span style="color:#a6e22e">generatePrimes</span>(<span style="color:#66d9ef">int</span> maxValue)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (maxValue <span style="color:#f92672">&gt;=</span> 2) <span style="color:#75715e">// the only valid case</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// declarations</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> s <span style="color:#f92672">=</span> maxValue <span style="color:#f92672">+</span> 1; <span style="color:#75715e">// size of array</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">boolean</span><span style="color:#f92672">[]</span> f <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">boolean</span><span style="color:#f92672">[</span>s<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> i;
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// initialize array to true.</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> 0; i <span style="color:#f92672">&lt;</span> s; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>            f<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// get rid of known non-primes</span>
</span></span><span style="display:flex;"><span>            f<span style="color:#f92672">[</span>0<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> f<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// sieve</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> j;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> 2; i <span style="color:#f92672">&lt;</span> Math.<span style="color:#a6e22e">sqrt</span>(s) <span style="color:#f92672">+</span> 1; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (f<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span>) <span style="color:#75715e">// if i is uncrossed, cross its multiples.</span>
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">for</span> (j <span style="color:#f92672">=</span> 2 <span style="color:#f92672">*</span> i; j <span style="color:#f92672">&lt;</span> s; j <span style="color:#f92672">+=</span> i)
</span></span><span style="display:flex;"><span>                    f<span style="color:#f92672">[</span>j<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>; <span style="color:#75715e">// multiple is not prime</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// how many primes are there?</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> count <span style="color:#f92672">=</span> 0;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> 0; i <span style="color:#f92672">&lt;</span> s; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (f<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span>)
</span></span><span style="display:flex;"><span>                count<span style="color:#f92672">++</span>; <span style="color:#75715e">// bump count.</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> primes <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[</span>count<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// move the primes into the result</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> 0, j <span style="color:#f92672">=</span> 0; i <span style="color:#f92672">&lt;</span> s; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (f<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span>) <span style="color:#75715e">// if prime</span>
</span></span><span style="display:flex;"><span>                primes<span style="color:#f92672">[</span>j<span style="color:#f92672">++]</span> <span style="color:#f92672">=</span> i;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> primes; <span style="color:#75715e">// return the primes</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> <span style="color:#75715e">// maxValue &lt; 2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[</span>0<span style="color:#f92672">]</span>; <span style="color:#75715e">// return null array if bad input.</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Trong Listing 4-8, bạn có thể thấy một phiên bản được tái cấu trúc của module trên. Chú ý rằng việc sử dụng comment được hạn chế tối đa. Chỉ có hai comment trong toàn bộ module và chúng đều hợp lý.</p>
<table>
<thead>
<tr>
<th>Listing 4-8 <strong>GeneratePrimes.java</strong></th>
</tr>
</thead>
</table>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * This class Generates prime numbers up to a user specified
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * maximum. The algorithm used is the Sieve of Eratosthenes.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Given an array of integers starting at 2:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Find the first uncrossed integer, and cross out all its
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * multiples. Repeat until there are no more multiples
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * in the array.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PrimeGenerator</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">boolean</span><span style="color:#f92672">[]</span> crossedOut;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> result;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> <span style="color:#a6e22e">generatePrimes</span>(<span style="color:#66d9ef">int</span> maxValue)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (maxValue <span style="color:#f92672">&lt;</span> 2)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[</span>0<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            uncrossIntegersUpTo(maxValue);
</span></span><span style="display:flex;"><span>            crossOutMultiples();
</span></span><span style="display:flex;"><span>            putUncrossedIntegersIntoResult();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> result;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">uncrossIntegersUpTo</span>(<span style="color:#66d9ef">int</span> maxValue)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        crossedOut <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">boolean</span><span style="color:#f92672">[</span>maxValue <span style="color:#f92672">+</span> 1<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 2; i <span style="color:#f92672">&lt;</span> crossedOut.<span style="color:#a6e22e">length</span>; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>            crossedOut<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">crossOutMultiples</span>()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> limit <span style="color:#f92672">=</span> determineIterationLimit();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 2; i <span style="color:#f92672">&lt;=</span> limit; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (notCrossed(i))
</span></span><span style="display:flex;"><span>                crossOutMultiplesOf(i);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">determineIterationLimit</span>()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Every multiple in the array has a prime factor that</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// is less than or equal to the root of the array size,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// so we don&#39;t have to cross out multiples of numbers</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// larger than that root.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">double</span> iterationLimit <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">sqrt</span>(crossedOut.<span style="color:#a6e22e">length</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> (<span style="color:#66d9ef">int</span>) iterationLimit;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">crossOutMultiplesOf</span>(<span style="color:#66d9ef">int</span> i)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> multiple <span style="color:#f92672">=</span> 2<span style="color:#f92672">*</span>i;
</span></span><span style="display:flex;"><span>                multiple <span style="color:#f92672">&lt;</span> crossedOut.<span style="color:#a6e22e">length</span>;
</span></span><span style="display:flex;"><span>                multiple <span style="color:#f92672">+=</span> i)
</span></span><span style="display:flex;"><span>            crossedOut<span style="color:#f92672">[</span>multiple<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">notCrossed</span>(<span style="color:#66d9ef">int</span> i)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> crossedOut<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">putUncrossedIntegersIntoResult</span>()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        result <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[</span>numberOfUncrossedIntegers()<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> 0, i <span style="color:#f92672">=</span> 2; i <span style="color:#f92672">&lt;</span> crossedOut.<span style="color:#a6e22e">length</span>; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (notCrossed(i))
</span></span><span style="display:flex;"><span>                result<span style="color:#f92672">[</span>j<span style="color:#f92672">++]</span> <span style="color:#f92672">=</span> i;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">numberOfUncrossedIntegers</span>()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> count <span style="color:#f92672">=</span> 0;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 2; i <span style="color:#f92672">&lt;</span> crossedOut.<span style="color:#a6e22e">length</span>; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (notCrossed(i))
</span></span><span style="display:flex;"><span>                count<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> count;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Thật dễ để chỉ ra comment đầu tiên là dư thừa vì nó đọc rất giống hàm generatePrimes. Tuy nhiên, tôi nghĩ rằng comment giúp người đọc dễ tiếp cận thuật toán, vì vậy tôi có xu hướng để lại nó.</p>
<p>Comment thứ hai chắc chắn là cần thiết. Nó giải thích lý do đằng sau việc sử dụng giá trị căn bậc hai làm giới hạn vòng lặp. Tôi không thể tìm thấy tên biến đơn giản hay cách thức khác để làm rõ điểm này. Mặt khác, việc sử dụng căn bậc hai có thể để lại vài vấn đề. Tôi có tiết kiệm được nhiều thời gian khi dùng giá trị căn bậc hai làm giới hạn cho vòng lặp hay không? Thời gian tiết kiệm được có nhiều hơn thời gian tính căn bậc hai hay không?</p>
<p>Hmm, thật đáng để suy nghĩ. Sử dụng căn bậc hai làm giới hạn vòng lặp đem lại thỏa mãn cho máu hacker trong tôi, nhưng tôi không nghĩ người khác cũng có máu đó. Một comment ở vị trí đó sẽ giúp người đọc dễ dàng hiểu nó hơn.</p>
<h3 id="tham-khảo">Tham khảo</h3>
<p><strong>[KP78]:</strong> Kernighan and Plaugher, <em>The Elements of Programming Style</em>, 2d. ed., McGrawHill, 1978.</p>

</div>
</div>
<div class="flex flex-row justify-around my-2">
  <h3 class="mb-1 mt-1 text-left mr-4">
    
    <a
      href="/blog/clean-code-chapter-5/"
      title="[Book] Clean Code - Chapter 5"
    >
      <i class="nav-menu fas fa-chevron-circle-left"></i>
    </a>
    
  </h3>
  <h3 class="mb-1 mt-1 text-left ml-4">
    
    <a
      href="/blog/clean-code-chapter-3/"
      title="[Book] Clean Code - Chapter 3"
    >
      <i class="nav-menu fas fa-chevron-circle-right"></i>
    </a>
    
  </h3>
</div>

<!DOCTYPE html>
<html lang="en">
<head>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>

    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js" onload="renderMathInElement(document.body);"></script>

    
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "\\[", right: "\\]", display: true },
                { left: "\\begin{align}", right: "\\end{align}", display: true },
                { left: "\\begin{bmatrix}", right: "\\end{bmatrix}", display: true },
            ],
        });
    });
    </script>

    
</head>
<body>
    
</body>
</html>

    </main>
    
    <footer class="text-sm text-center border-t border-gray-300 dark:border-gray-700  py-6 ">
  <figure>
    <embed src="https://wakatime.com/share/@phatcvo/ef5cf505-baef-4bdb-968e-ee58794efd63.svg" style="width: 50%; height: auto;"></embed>
  </figure>
  <p class="markdownify">© 2024 · phatcvo</p>
  <p style="font-size:0px;">
    <i>
      <a href="https://github.com/darshanbaral/aafu">
        aafu
      </a>
    </i>
    by
    <a href="https://www.darshanbaral.com/">
      darshan
    </a>
  </p>
</footer>

    
  </body>
</html>
